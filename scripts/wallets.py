import web3
import json
from eth_abi import encode_single


# with open("Wallet.json") as f:
#   wallet = json.load(f)



bytesToHex = lambda x: ''.join(['%02X' % b for b in x])

def buildCreate2Address(creatorAddr, saltBytes, byteCode):
    if creatorAddr[:2] == '0x':
        addr = creatorAddr[2:]
    else:
        addr = creatorAddr
    creatorBytes = bytes.fromhex(addr)
    byteCodeHash = web3.Web3.keccak(byteCode)
    msg = bytes.fromhex('ff') + creatorBytes + saltBytes + byteCodeHash
    return web3.Web3.keccak(msg)[12:]


if __name__ == "__main__":
    fabric = "0x5FC8d32690cc91D4c39d9d3abcBD16989F875707"
    byteCode = bytes.fromhex("608060405273c631dbe5b364033bba5195bb2a5f9a987b6a18a06000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555034801561006457600080fd5b5060405161038038038061038083398181016040528101906100869190610215565b8073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016100fc91906102ae565b60206040518083038186803b15801561011457600080fd5b505afa158015610128573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061014c9190610267565b6040518363ffffffff1660e01b81526004016101699291906102c9565b602060405180830381600087803b15801561018357600080fd5b505af1158015610197573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101bb919061023e565b50600073ffffffffffffffffffffffffffffffffffffffff16ff5b6000815190506101e58161033a565b92915050565b6000815190506101fa81610351565b92915050565b60008151905061020f81610368565b92915050565b60006020828403121561022757600080fd5b6000610235848285016101d6565b91505092915050565b60006020828403121561025057600080fd5b600061025e848285016101eb565b91505092915050565b60006020828403121561027957600080fd5b600061028784828501610200565b91505092915050565b610299816102f2565b82525050565b6102a881610330565b82525050565b60006020820190506102c36000830184610290565b92915050565b60006040820190506102de6000830185610290565b6102eb602083018461029f565b9392505050565b60006102fd82610310565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b610343816102f2565b811461034e57600080fd5b50565b61035a81610304565b811461036557600080fd5b50565b61037181610330565b811461037c57600080fd5b5056fe")
    tokenAddr = "0x0165878A594ca255338adfa4d48449f69242Eb8F"
    constructorAbi = encode_single('address', tokenAddr)
    byteCodeArgs = byteCode + constructorAbi
    saltBytes = encode_single('uint256',1)
    addr = buildCreate2Address(fabric, saltBytes, byteCodeArgs)
    print(addr)